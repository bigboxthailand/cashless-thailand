let l=[],o=0;const c=4,b=e=>{let i=[],t={get(){return t.lc||t.listen(()=>{})(),t.value},lc:0,listen(s){return t.lc=i.push(s),()=>{for(let d=o+c;d<l.length;)l[d]===s?l.splice(d,c):d+=c;let n=i.indexOf(s);~n&&(i.splice(n,1),--t.lc||t.off())}},notify(s,n){let d=!l.length;for(let r of i)l.push(r,t.value,s,n);if(d){for(o=0;o<l.length;o+=c)l[o](l[o+1],l[o+2],l[o+3]);l.length=0}},off(){},set(s){let n=t.value;n!==s&&(t.value=s,t.notify(n))},subscribe(s){let n=t.listen(s);return s(t.value),n},value:e};return t},m=5,v=6,w=10;let I=(e,i,t,s)=>(e.events=e.events||{},e.events[t+w]||(e.events[t+w]=s(n=>{e.events[t].reduceRight((d,r)=>(r(d),d),{shared:{},...n})})),e.events[t]=e.events[t]||[],e.events[t].push(i),()=>{let n=e.events[t],d=n.indexOf(i);n.splice(d,1),n.length||(delete e.events[t],e.events[t+w](),delete e.events[t+w])}),O=1e3,N=(e,i)=>I(e,s=>{let n=i(s);n&&e.events[v].push(n)},m,s=>{let n=e.listen;e.listen=(...r)=>(!e.lc&&!e.active&&(e.active=!0,s()),n(...r));let d=e.off;return e.events[v]=[],e.off=()=>{d(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let r of e.events[v])r();e.events[v]=[]}},O)},()=>{e.listen=n,e.off=d}}),L=e=>e,a={},g={addEventListener(){},removeEventListener(){}};function T(){try{return typeof localStorage<"u"}catch{return!1}}T()&&(a=localStorage);let S={addEventListener(e,i,t){window.addEventListener("storage",i),window.addEventListener("pageshow",t)},removeEventListener(e,i,t){window.removeEventListener("storage",i),window.removeEventListener("pageshow",t)}};typeof window<"u"&&(g=S);function q(e,i=void 0,t={}){let s=t.encode||L,n=t.decode||L,d=b(i),r=d.set;d.set=f=>{let y=s(f);typeof y>"u"?delete a[e]:a[e]=y,r(f)};function h(f){f.key===e?f.newValue===null?r(i):r(n(f.newValue)):a[e]||r(i)}function p(){d.set(a[e]?n(a[e]):i)}return N(d,()=>{if(p(),t.listen!==!1)return g.addEventListener(e,h,p),()=>{g.removeEventListener(e,h,p)}}),d}const u=q("cashless-cart",[],{encode:JSON.stringify,decode:JSON.parse}),E=b(!1),x={get:()=>u.get(),add:e=>{const i=u.get();i.find(s=>s.id===e.id)?u.set(i.map(s=>s.id===e.id?{...s,quantity:(s.quantity||1)+1}:s)):u.set([...i,{...e,quantity:1}]),E.set(!0),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("cart-updated",{bubbles:!0})),window.dispatchEvent(new CustomEvent("toggle-cart",{detail:{open:!0},bubbles:!0})))},remove:e=>{const i=u.get();u.set(i.filter(t=>t.id!==e)),typeof window<"u"&&window.dispatchEvent(new CustomEvent("cart-updated",{bubbles:!0}))},updateQty:(e,i)=>{const s=u.get().map(n=>{if(n.id===e){const d=(n.quantity||0)+i;return d>0?{...n,quantity:d}:n}return n});u.set(s),typeof window<"u"&&window.dispatchEvent(new CustomEvent("cart-updated",{bubbles:!0}))},totals:()=>{const e=u.get(),i=e.reduce((n,d)=>n+Number(d.price)*(d.quantity||1),0),t=Math.floor(i/3),s=e.reduce((n,d)=>n+(d.quantity||1),0);return{total:i,sats:t,count:s}},open:()=>{E.set(!0),typeof window<"u"&&window.dispatchEvent(new CustomEvent("toggle-cart",{detail:{open:!0},bubbles:!0}))},close:()=>{E.set(!1),typeof window<"u"&&window.dispatchEvent(new CustomEvent("toggle-cart",{detail:{open:!1},bubbles:!0}))},clear:()=>{u.set([]),typeof window<"u"&&window.dispatchEvent(new CustomEvent("cart-updated",{bubbles:!0}))}};export{x as c};
