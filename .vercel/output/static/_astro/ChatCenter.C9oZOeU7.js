import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as n}from"./index.WFquGv8Z.js";import{s as o}from"./supabase.B9bYqD4q.js";import"./index.DR2MMlUt.js";function M(){const[c,b]=n.useState([]),[s,h]=n.useState(null),[w,u]=n.useState([]),[l,m]=n.useState(""),[i,v]=n.useState(null),p=n.useRef(null);n.useEffect(()=>{o.auth.getSession().then(({data:{session:t}})=>{if(!t){window.location.href="/login";return}v(t),j(t.user.id);const a=new URLSearchParams(window.location.search).get("id");a&&h(a)})},[]);const j=async t=>{const{data:r,error:a}=await o.from("conversation_participants").select(`
                conversation_id,
                conversation:conversations (
                    id, type, title, updated_at, metadata
                )
            `).eq("user_id",t).order("last_read_at",{ascending:!1});if(r){const d=r.map(x=>x.conversation);d.sort((x,y)=>new Date(y.updated_at)-new Date(x.updated_at)),b(d)}};n.useEffect(()=>{if(!s||!i)return;(async()=>{const{data:a}=await o.from("messages").select("*").eq("conversation_id",s).order("created_at",{ascending:!0});u(a||[]),f()})();const r=o.channel(`chat:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${s}`},a=>{u(d=>[...d,a.new]),f()}).subscribe();return()=>{o.removeChannel(r)}},[s,i]);const f=()=>{setTimeout(()=>p.current?.scrollIntoView({behavior:"smooth"}),100)},g=async t=>{if(t.preventDefault(),!l.trim()||!s||!i)return;const r=l.trim();m(""),await o.from("messages").insert({conversation_id:s,sender_id:i.user.id,content:r})};if(!i)return e.jsx("div",{className:"p-10 text-center text-white",children:"Loading Chat..."});const N=c.find(t=>t.id===s);return e.jsxs("div",{className:"flex h-[calc(100vh-80px)] bg-[#050505] overflow-hidden",children:[e.jsxs("div",{className:`w-full md:w-80 bg-[#111] border-r border-white/10 flex flex-col ${s?"hidden md:flex":"flex"}`,children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Messages"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:c.length===0?e.jsx("div",{className:"p-6 text-white/30 text-center text-sm",children:"No conversations yet."}):c.map(t=>e.jsxs("button",{onClick:()=>h(t.id),className:`w-full text-left p-4 border-b border-white/5 hover:bg-white/5 transition-colors ${s===t.id?"bg-white/5 border-l-2 border-l-[#D4AF37]":""}`,children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h4",{className:"text-white font-bold truncate pr-2",children:t.title||(t.type==="support"?"Support Chat":"Conversation")}),e.jsx("span",{className:"text-[10px] text-white/30 whitespace-nowrap",children:new Date(t.updated_at).toLocaleDateString()})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("span",{className:"text-xs text-white/50 bg-white/10 px-2 py-0.5 rounded uppercase tracking-wider",children:t.type})})]},t.id))})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-[#050505] relative ${s?"flex":"hidden md:flex"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-16 px-6 border-b border-white/10 flex items-center gap-4 bg-[#111]/50 backdrop-blur-md",children:[e.jsx("button",{onClick:()=>h(null),className:"md:hidden text-white/50 hover:text-white",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold",children:N?.title||"Chat"}),e.jsxs("span",{className:"text-xs text-[#D4AF37] opacity-80 flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),"Online"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[w.map((t,r)=>{const a=t.sender_id===i.user.id;return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[70%] md:max-w-[50%] p-4 rounded-3xl text-sm leading-relaxed ${a?"bg-[#D4AF37] text-black rounded-tr-sm shadow-[0_0_15px_rgba(212,175,55,0.2)]":"bg-[#222] text-white rounded-tl-sm border border-white/10"}`,children:t.content})},t.id||r)}),e.jsx("div",{ref:p})]}),e.jsx("div",{className:"p-4 md:p-6 bg-[#111] border-t border-white/10",children:e.jsxs("form",{onSubmit:g,className:"flex gap-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{value:l,onChange:t=>m(t.target.value),placeholder:"Type your message...",className:"w-full bg-[#222] border border-white/10 rounded-full pl-6 pr-12 py-3 text-white focus:outline-none focus:border-[#D4AF37] focus:ring-1 focus:ring-[#D4AF37] transition-all"}),e.jsx("button",{type:"button",className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/30 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})})]}),e.jsx("button",{type:"submit",disabled:!l.trim(),className:"bg-[#D4AF37] text-black w-12 h-12 rounded-full flex items-center justify-center hover:scale-105 active:scale-95 disabled:opacity-50 disabled:scale-100 transition-all shadow-[0_0_20px_rgba(212,175,55,0.3)]",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-white/30",children:[e.jsx("svg",{className:"w-16 h-16 mb-4 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{children:"Select a conversation to start chatting"})]})})]})}export{M as default};
