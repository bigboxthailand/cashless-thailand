import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as x}from"./index.WFquGv8Z.js";import{s as u}from"./supabase.B9bYqD4q.js";import{A as X}from"./index.CojmwtN0.js";import{m as Y}from"./proxy.Bc5WEKy4.js";import"./index.DR2MMlUt.js";const ne=({shopId:m})=>{const[N,f]=x.useState([]),[P,b]=x.useState(!1),[k,C]=x.useState(!1),[v,w]=x.useState(!1),[g,y]=x.useState("basic"),A={id:null,name:"",category:"Hardware Wallet",subcategory:"",description:"",images:["","","","",""],video:"",brand:"",model:"",condition:"New",price:"",stock:"",sku:"",hasVariants:!1,variantOptions:[],variantCombinations:[],weight:"",width:"",length:"",height:"",marketing:{headline:"",subheadline:"",benefits:[]},techSpecs:[],manualLink:""},[a,o]=x.useState(A),[D,E]=x.useState(""),[J,Q]=x.useState("list"),T={"Hardware Wallet":["Trezor","Ledger","Tangem","OneKey","BitBox","Keystone"],Clock:["BitBlock","Tickr","Custom","Desktop","Wall"],Accessory:["Cable","Case","Stand","Sticker","Seed Storage"],Kiosk:["POS Terminal","ATM","Display","Vending"],Book:["Education","Novel","Comic","Whitepaper","Technical","Investment"],eBook:["PDF","ePub","Kindle","Audiobook"],"Digital Content":["Course","Voucher","Subscription","License"],Merchandise:["T-Shirt","Cap","Hoodie","Mug","Bag","Sticker Pack"],Shirt:["T-Shirt","Polo","Hoodie"],Keychain:["Metal","Acrylic","Leather"],Mug:["Ceramic","Thermal","Travel"]},M=t=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(t);x.useEffect(()=>{m&&V()},[m]);const V=async()=>{try{const{data:t,error:i}=await u.from("products").select("*").eq("shop_id",m).order("created_at",{ascending:!1});if(i)throw i;f(t||[])}catch(t){console.error("Error fetching products:",t)}},S=t=>t.config?.hasVariants&&t.config?.variants?.length>0?t.config.variants.reduce((i,s)=>i+(parseInt(s.stock)||0),0):parseInt(t.config?.inventory?.stock||t.inventory?.stock||t.stock||0),$=t=>t===0?"text-red-500":t<10?"text-yellow-500":"text-green-500",L=()=>{C(!1),o(A),y("basic"),b(!0)},B=t=>{C(!0),y("basic");const i=t.meta||{},s=t.config||{},r=t.pricing||{},n=t.inventory||s.inventory||{},l=t.media||{},c=t.shipping||{},h=!!(s.variants&&s.variants.length>0);let d=s.variantOptions||[],p=s.variants||[];h&&d.length===0&&(d=[{name:"Variation",values:p.map(O=>O.name)}]),o({id:t.id,name:t.name||t.title||i.title||"",category:s.category||t.category||"Hardware Wallet",subcategory:s.subcategory||"",description:i.description||"",images:[l.mainImage||t.image_url||"",...l.gallery||["","","",""]].slice(0,5),video:l.video||"",brand:i.brand||"",model:i.model||"",condition:i.condition||"New",price:r.basePrice||t.price||"",stock:n.stock||t.stock||"",sku:n.sku||"",hasVariants:h,variantOptions:d,variantCombinations:p,weight:c.weight||n.weight||"",length:c.length||n.dimensions?.length||"",width:c.width||n.dimensions?.width||"",height:c.height||n.dimensions?.height||"",marketing:s.marketing||{headline:"",subheadline:"",benefits:[]},techSpecs:s.techSpecs||[],manualLink:s.manualLink||""}),b(!0)},H=async t=>{t.preventDefault(),w(!0);try{let i=parseFloat(a.price)||0;if((i===0||!a.price)&&a.hasVariants&&a.variantCombinations.length>0){const l=a.variantCombinations.map(c=>parseFloat(c.price)||0).filter(c=>c>0);l.length>0&&(i=Math.min(...l))}const s=a.name.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""),r={shop_id:m,category:a.category,meta:{title:a.name,description:a.description,brand:a.brand,model:a.model,condition:a.condition},config:{hasVariants:a.hasVariants,variantOptions:a.hasVariants?a.variantOptions:[],variants:a.hasVariants?a.variantCombinations:[],subcategory:a.subcategory,inventory:{stock:parseInt(a.stock)||0,sku:a.sku||`SKU-${Date.now()}`,weight:parseFloat(a.weight)||0,dimensions:{width:parseFloat(a.width)||0,length:parseFloat(a.length)||0,height:parseFloat(a.height)||0}},marketing:a.marketing,techSpecs:a.techSpecs,manualLink:a.manualLink},media:{mainImage:a.images[0]||"https://placehold.co/400",gallery:a.images.slice(1).filter(l=>l),video:a.video},pricing:{basePrice:i,currency:"THB"}};let n;if(k){const{data:l,error:c}=await u.from("products").update(r).eq("id",a.id).eq("shop_id",m).select().single();!c&&l&&f(h=>h.map(d=>d.id===l.id?l:d)),n=c}else{const l=`${s}-${Date.now().toString().slice(-4)}`,{data:c,error:h}=await u.from("products").insert([{...r,id:l}]).select().single();!h&&c&&f(d=>[c,...d]),n=h}if(n)throw n;b(!1)}catch(i){console.error("Error saving product:",i),alert("Failed to save product: "+i.message)}finally{w(!1)}},I=t=>new Promise(i=>{const s=new FileReader;s.readAsDataURL(t),s.onload=r=>{const n=new Image;n.src=r.target.result,n.onload=()=>{const l=document.createElement("canvas"),c=1200,h=1200;let d=n.width,p=n.height;d>p?d>c&&(p*=c/d,d=c):p>h&&(d*=h/p,p=h),l.width=d,l.height=p,l.getContext("2d").drawImage(n,0,0,d,p),l.toBlob(G=>{i(new File([G],t.name,{type:t.type,lastModified:Date.now()}))},t.type,.7)}}}),U=async(t,i)=>{let s=t.target.files[0];if(s){s.size>2*1024*1024&&(s=await I(s));try{w(!0);const r=s.name.split(".").pop(),n=`seller/${m}/${Date.now()}-${Math.random().toString(36).substr(2,9)}.${r}`,{error:l}=await u.storage.from("products").upload(n,s);if(l)throw l;const{data:{publicUrl:c}}=u.storage.from("products").getPublicUrl(n),h=[...a.images];h[i]=c,o({...a,images:h})}catch(r){alert("Upload failed: "+r.message)}finally{w(!1)}}},_=async t=>{if(window.confirm("Delete this product?"))try{const{error:i}=await u.from("products").delete().eq("id",t).eq("shop_id",m);if(i)throw i;f(s=>s.filter(r=>r.id!==t))}catch(i){alert("Failed to delete: "+i.message)}},q=()=>{o(t=>({...t,variantOptions:[...t.variantOptions,{name:"",values:[]}]}))},K=(t,i)=>{const s=[...a.variantOptions];s[t].name=i,o(r=>({...r,variantOptions:s}))},z=(t,i)=>{if(!i)return;const s=[...a.variantOptions];s[t].values.includes(i)||(s[t].values.push(i),o(r=>({...r,variantOptions:s})),F(s))},R=(t,i)=>{const s=[...a.variantOptions];s[t].values.splice(i,1),o(r=>({...r,variantOptions:s})),F(s)},F=t=>{if(t.length===0){o(n=>({...n,variantCombinations:[]}));return}const i=t[0],s=t[1];let r=[];s&&s.values.length>0?i.values.forEach(n=>{s.values.forEach(l=>{r.push({name:`${n} - ${l}`,price:a.price||"",stock:a.stock||"",sku:`${a.sku}-${n}-${l}`.toUpperCase(),image:""})})}):i.values.forEach(n=>{r.push({name:n,price:a.price||"",stock:a.stock||"",sku:`${a.sku}-${n}`.toUpperCase(),image:""})}),o(n=>({...n,variantCombinations:r}))},j=(t,i,s)=>{const r=[...a.variantCombinations];r[t][i]=s,o(n=>({...n,variantCombinations:r}))},W=N.filter(t=>(t.name||t.meta?.title||"").toLowerCase().includes(D.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-white uppercase",children:"Products"}),e.jsxs("p",{class:"text-white/50 text-sm",children:[N.length," items listed"]})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search products...",value:D,onChange:t=>E(t.target.value),className:"bg-black/50 border border-white/10 rounded-xl px-4 py-2 text-white outline-none focus:border-[#D4AF37] w-full"}),e.jsx("button",{onClick:L,className:"bg-[#D4AF37] text-black font-bold px-6 py-2 rounded-xl whitespace-nowrap hover:bg-[#b89530]",children:"+ Add New"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:W.map(t=>e.jsxs("div",{className:"bg-[#111] border border-white/10 rounded-2xl overflow-hidden group hover:border-[#D4AF37] transition-all",children:[e.jsxs("div",{className:"aspect-square relative",children:[e.jsx("img",{src:t.media?.mainImage||t.image_url||"https://placehold.co/400",className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>B(t),className:"bg-white text-black px-3 py-1 rounded-full text-xs font-bold",children:"Edit"}),e.jsx("button",{onClick:()=>_(t.id),className:"bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold",children:"Del"})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-white text-sm line-clamp-2 min-h-[40px]",children:t.name||t.meta?.title}),e.jsxs("div",{className:"flex justify-between items-end mt-2",children:[e.jsx("span",{className:"text-[#D4AF37] font-bold",children:M(t.pricing?.basePrice||t.price)}),e.jsxs("span",{className:`text-xs font-bold ${$(S(t))}`,children:[S(t)," in stock"]})]})]})]},t.id))}),e.jsx(X,{children:P&&e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-md",onClick:()=>b(!1)}),e.jsxs(Y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-[#1a1a1a] border border-white/10 rounded-3xl w-full max-w-5xl h-[85vh] flex flex-col relative z-10 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center bg-[#111]",children:[e.jsx("h2",{className:"text-xl font-black text-white uppercase",children:k?"Edit Product":"Add Product"}),e.jsx("button",{onClick:()=>b(!1),className:"text-white/50 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-48 bg-[#111] border-r border-white/5 p-4 space-y-2",children:["basic","media","sales","marketing"].map(t=>e.jsx("button",{onClick:()=>y(t),className:`w-full text-left px-4 py-3 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${g===t?"bg-[#D4AF37]/10 text-[#D4AF37] border border-[#D4AF37]/20":"text-white/40 hover:text-white"}`,children:t},t))}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8 space-y-8 bg-[#161616]",children:e.jsxs("form",{id:"seller-product-form",onSubmit:H,className:"max-w-3xl mx-auto space-y-8",children:[g==="basic"&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Product Name"}),e.jsx("input",{required:!0,type:"text",value:a.name,onChange:t=>o({...a,name:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none",placeholder:"e.g. Ledger Nano X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Category"}),e.jsx("select",{value:a.category,onChange:t=>o({...a,category:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none",children:Object.keys(T).map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Description"}),e.jsx("textarea",{required:!0,rows:"5",value:a.description,onChange:t=>o({...a,description:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none resize-none"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Brand"}),e.jsx("input",{type:"text",value:a.brand,onChange:t=>o({...a,brand:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Model"}),e.jsx("input",{type:"text",value:a.model,onChange:t=>o({...a,model:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Condition"}),e.jsxs("select",{value:a.condition,onChange:t=>o({...a,condition:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none",children:[e.jsx("option",{children:"New"}),e.jsx("option",{children:"Used"}),e.jsx("option",{children:"Refurbished"})]})]})]})]}),g==="media"&&e.jsx("div",{className:"space-y-6 animate-fade-in",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:a.images.map((t,i)=>e.jsxs("div",{className:"aspect-square bg-black/50 border border-white/10 rounded-xl relative overflow-hidden group",children:[t?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{const s=[...a.images];s[i]="",o({...a,images:s})},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:"✕"})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-full cursor-pointer hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-2xl text-white/20",children:"+"}),e.jsx("span",{className:"text-[8px] uppercase font-bold text-white/30 mt-2",children:i===0?"Main":"Gallery"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>U(s,i)})]}),v&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:e.jsx("div",{className:"w-5 h-5 border-2 border-[#D4AF37] rounded-full animate-spin border-t-transparent"})})]},i))})}),g==="sales"&&e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white/5 rounded-xl border border-white/5",children:[e.jsx("input",{type:"checkbox",checked:a.hasVariants,onChange:t=>o({...a,hasVariants:t.target.checked}),className:"w-5 h-5 accent-[#D4AF37]"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:"Product has variations?"}),e.jsx("p",{className:"text-xs text-white/40",children:"Enable this for sizes, colors, etc."})]})]}),a.hasVariants?e.jsxs("div",{className:"space-y-6",children:[a.variantOptions.map((t,i)=>e.jsxs("div",{className:"bg-black/30 border border-white/10 p-4 rounded-xl",children:[e.jsx("div",{className:"flex gap-4 mb-3",children:e.jsx("input",{type:"text",placeholder:"Option Name (e.g. Color)",value:t.name,onChange:s=>K(i,s.target.value),className:"bg-transparent border-b border-white/20 text-white text-sm focus:border-[#D4AF37] outline-none px-2 py-1 w-full"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.values.map((s,r)=>e.jsxs("span",{className:"px-3 py-1 bg-white/10 rounded-full text-xs text-white flex items-center gap-2",children:[s," ",e.jsx("button",{type:"button",onClick:()=>R(i,r),className:"text-white/50 hover:text-white",children:"x"})]},r)),e.jsx("input",{type:"text",placeholder:"+ Add Value & Enter",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),z(i,s.target.value),s.target.value="")},className:"bg-transparent text-xs text-white placeholder:text-white/30 outline-none w-32"})]})]},i)),a.variantOptions.length<2&&e.jsx("button",{type:"button",onClick:q,className:"text-xs text-[#D4AF37] font-bold uppercase hover:underline",children:"+ Add Another Option"}),a.variantCombinations.length>0&&e.jsx("div",{className:"overflow-x-auto border border-white/10 rounded-xl",children:e.jsxs("table",{className:"w-full text-sm text-left text-white",children:[e.jsx("thead",{className:"bg-white/5 text-xs font-bold uppercase text-white/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"Variant"}),e.jsx("th",{className:"p-3",children:"Price"}),e.jsx("th",{className:"p-3",children:"Stock"}),e.jsx("th",{className:"p-3",children:"SKU"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:a.variantCombinations.map((t,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-3 font-bold",children:t.name}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:t.price,onChange:s=>j(i,"price",s.target.value),className:"bg-black/50 border border-white/10 rounded px-2 py-1 w-24 text-white text-xs"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"number",value:t.stock,onChange:s=>j(i,"stock",s.target.value),className:"bg-black/50 border border-white/10 rounded px-2 py-1 w-20 text-white text-xs"})}),e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"text",value:t.sku,onChange:s=>j(i,"sku",s.target.value),className:"bg-black/50 border border-white/10 rounded px-2 py-1 w-28 text-white text-xs"})})]},i))})]})})]}):e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Price (THB)"}),e.jsx("input",{type:"number",value:a.price,onChange:t=>o({...a,price:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-[#D4AF37] font-bold focus:border-[#D4AF37] outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Stock"}),e.jsx("input",{type:"number",value:a.stock,onChange:t=>o({...a,stock:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"SKU"}),e.jsx("input",{type:"text",value:a.sku,onChange:t=>o({...a,sku:t.target.value}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none"})]})]})]}),g==="marketing"&&e.jsx("div",{className:"space-y-6 animate-fade-in",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-white/40",children:"Marketing Headline"}),e.jsx("input",{type:"text",value:a.marketing.headline,onChange:t=>o({...a,marketing:{...a.marketing,headline:t.target.value}}),className:"w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#D4AF37] outline-none",placeholder:"Short catchy phrase"})]})}),e.jsx("div",{className:"pt-8 border-t border-white/5 flex gap-4",children:e.jsx("button",{type:"submit",disabled:v,className:"flex-1 bg-[#D4AF37] text-black font-black uppercase tracking-widest py-4 rounded-xl hover:bg-[#b89530] transition-transform active:scale-95 disabled:opacity-50",children:v?"Saving...":"Save Product"})})]})})]})]})]})})]})};export{ne as default};
