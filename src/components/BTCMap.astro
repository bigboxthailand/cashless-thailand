---
// src/components/BTCMap.astro
---

<section class="relative py-32 bg-[#050505] overflow-hidden" id="btc-map">
    <!-- Background Glow -->
    <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,_rgba(212,175,55,0.05)_0%,_transparent_70%)] pointer-events-none"
    >
    </div>

    <div class="max-w-7xl mx-auto px-6 md:px-12 relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
            <!-- Content Side -->
            <div
                class="lg:col-span-5 flex flex-col h-full reveal-element pb-10"
            >
                <div class="space-y-10">
                    <div class="space-y-4">
                        <span
                            class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 text-[#D4AF37] font-bold tracking-[0.2em] uppercase text-[10px] backdrop-blur-md"
                        >
                            <span
                                class="w-1.5 h-1.5 bg-[#D4AF37] rounded-full animate-ping"
                            ></span>
                            Live Adoption Map
                        </span>
                        <h2
                            class="text-4xl md:text-6xl font-black text-white leading-tight tracking-tighter"
                        >
                            Bitcoin <br />
                            <span
                                class="inline-block text-transparent bg-clip-text bg-gradient-to-r from-[#D4AF37] via-[#F4E08F] to-white italic px-2"
                                >Merchant Map</span
                            >
                        </h2>
                        <p
                            class="text-white/60 text-lg font-light leading-relaxed max-w-md"
                        >
                            สำรวจเครือข่ายร้านค้าที่รับชำระด้วย Bitcoin
                            ทั่วประเทศไทย ค้นหาสถานที่กิน ดื่ม เที่ยว
                            และใช้ชีวิตด้วยระบบการเงินแห่งอนาคต
                        </p>
                    </div>

                    <!-- Stats Dashboard -->
                    <div class="grid grid-cols-2 gap-4">
                        <div
                            class="p-6 rounded-[2rem] bg-white/[0.03] border border-white/10 backdrop-blur-xl group hover:border-[#D4AF37]/30 transition-all duration-500"
                        >
                            <p
                                class="text-white/40 text-[10px] font-black uppercase tracking-widest mb-2"
                            >
                                Merchants in TH
                            </p>
                            <div class="flex items-end gap-2">
                                <span
                                    class="text-3xl font-black text-white group-hover:text-[#D4AF37] transition-colors"
                                    >452</span
                                >
                                <span
                                    class="text-[#D4AF37] text-xs font-bold mb-1"
                                    >+12%</span
                                >
                            </div>
                        </div>
                        <div
                            class="p-6 rounded-[2rem] bg-white/[0.03] border border-white/10 backdrop-blur-xl group hover:border-[#D4AF37]/30 transition-all duration-500"
                        >
                            <p
                                class="text-white/40 text-[10px] font-black uppercase tracking-widest mb-2"
                            >
                                Verified Outlets
                            </p>
                            <div class="flex items-end gap-2">
                                <span
                                    class="text-3xl font-black text-white group-hover:text-[#D4AF37] transition-colors"
                                    >382</span
                                >
                                <span class="text-white/20 text-[10px] mb-1"
                                    >locations</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 mt-auto pt-10">
                    <a
                        href="https://btcmap.org/map"
                        target="_blank"
                        class="group flex items-center justify-center gap-3 px-8 py-4 bg-white text-black rounded-full font-black text-sm tracking-widest uppercase hover:bg-[#D4AF37] transition-all duration-300"
                    >
                        <span>Open Full Map</span>
                        <svg
                            class="w-4 h-4 transform group-hover:translate-x-1 transition-transform"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg
                        >
                    </a>
                    <a
                        href="https://btcmap.org/add-location"
                        target="_blank"
                        class="flex items-center justify-center gap-3 px-8 py-4 bg-white/5 text-white/80 border border-white/10 rounded-full font-bold text-sm tracking-widest uppercase hover:bg-white/10 transition-all duration-300"
                    >
                        Add Your Shop
                    </a>
                </div>
            </div>

            <!-- Map Side -->
            <div class="lg:col-span-7 relative group reveal-element">
                <!-- Premium Border Glow -->
                <div
                    class="absolute -inset-1 bg-gradient-to-tr from-[#D4AF37]/20 via-transparent to-[#D4AF37]/10 rounded-[3rem] blur-2xl opacity-50 group-hover:opacity-80 transition-opacity duration-700"
                >
                </div>

                <div
                    class="relative aspect-square md:aspect-video lg:aspect-[4/3] w-full rounded-[3rem] overflow-hidden border border-white/10 bg-[#0a0a0a] shadow-2xl"
                >
                    <!-- Map Loading State Overlay -->
                    <div
                        id="map-loader"
                        class="absolute inset-0 z-20 bg-black flex flex-col items-center justify-center transition-opacity duration-1000"
                    >
                        <div
                            class="w-12 h-12 border-2 border-[#D4AF37]/20 border-t-[#D4AF37] rounded-full animate-spin mb-4"
                        >
                        </div>
                        <p
                            class="text-[10px] font-black text-white/40 uppercase tracking-[0.3em] font-mono"
                        >
                            Loading Realtime Data
                        </p>
                    </div>

                    <div
                        class="absolute inset-x-0 top-0 h-16 bg-gradient-to-b from-[#0a0a0a] to-transparent z-10 pointer-events-none"
                    >
                    </div>

                    <!-- Reset Map Button on our UI side -->
                    <button
                        id="reset-map"
                        class="absolute top-6 right-6 z-30 p-3 bg-black/60 backdrop-blur-xl rounded-2xl text-white/70 hover:text-[#D4AF37] hover:scale-110 transition-all duration-300 border border-white/10 group shadow-2xl"
                        title="Back to Thailand Overview"
                    >
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path
                                d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                            ></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span
                            class="absolute right-full mr-4 px-3 py-1.5 bg-black/80 backdrop-blur-md text-[10px] font-black uppercase tracking-widest text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none border border-white/10"
                        >
                            Reset to Thailand
                        </span>
                    </button>

                    <div class="w-full h-full relative overflow-hidden">
                        <iframe
                            id="btcmap-iframe"
                            src="https://btcmap.org/map?lat=13.7563&lng=100.5018&zoom=6"
                            class="absolute inset-0 w-full h-full opacity-0 transition-opacity duration-1000"
                            style="border:0;"
                            allow="geolocation"
                            title="BTC Map Thailand"></iframe>
                    </div>

                    <!-- Decorative Overlay -->
                    <div
                        class="absolute inset-x-0 bottom-0 p-6 bg-gradient-to-t from-black/80 to-transparent pointer-events-none z-10"
                    >
                        <div
                            class="flex items-center gap-4 text-[10px] font-black uppercase tracking-widest text-white/60"
                        >
                            <span class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-[#D4AF37]"
                                ></span> Verified
                            </span>
                            <span class="flex items-center gap-1.5">
                                <span class="w-2 h-2 rounded-full bg-white/20"
                                ></span> Unverified
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    function initBTCMap() {
        const iframe = document.getElementById(
            "btcmap-iframe",
        ) as HTMLIFrameElement;
        const loader = document.getElementById("map-loader");
        const resetBtn = document.getElementById("reset-map");

        if (iframe && loader) {
            const hideLoader = () => {
                setTimeout(() => {
                    loader.classList.add("opacity-0");
                    iframe.classList.remove("opacity-0");
                    setTimeout(() => {
                        loader.style.display = "none";
                    }, 1000);
                }, 500);
            };

            const showLoader = () => {
                loader.style.display = "flex";
                loader.classList.remove("opacity-0");
                iframe.classList.add("opacity-0");
            };

            // Check if already loaded
            if (
                iframe.contentDocument &&
                iframe.contentDocument.readyState === "complete"
            ) {
                hideLoader();
            } else {
                iframe.onload = hideLoader;
            }

            // Safety timeout (5 seconds)
            setTimeout(hideLoader, 5000);

            // Reset Logic
            if (resetBtn) {
                resetBtn.addEventListener("click", () => {
                    showLoader();
                    iframe.src =
                        "https://btcmap.org/map?lat=13.7563&lng=100.5018&zoom=6";
                    // The onload handler is already set above to hide loader on next load
                });
            }
        }

        const observerOptions = {
            root: null,
            rootMargin: "0px",
            threshold: 0.1,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("is-visible");
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document
            .querySelectorAll(".reveal-element")
            .forEach((el) => observer.observe(el));
    }

    document.addEventListener("astro:page-load", initBTCMap);
</script>

<style>
    .reveal-element {
        opacity: 0;
        transform: translateY(40px);
        transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .reveal-element.is-visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>
