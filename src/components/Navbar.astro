---
// src/components/Navbar.astro
---

<nav class="fixed top-0 left-0 w-full z-[100] transition-all duration-300 border-b border-transparent" id="main-nav">
    <div class="absolute inset-0 bg-[#050505]/80 backdrop-blur-md opacity-0 transition-opacity duration-300" id="nav-bg"></div>
    
    <div class="max-w-[1800px] mx-auto px-6 md:px-12 h-24 flex items-center justify-between relative z-10">
        
        <a href="/" class="group relative flex items-center gap-3">
            <img 
                src="/images/ui/logo.webp" 
                alt="Cashless Thailand Logo" 
                class="h-10 w-auto object-contain group-hover:scale-105 transition-transform duration-300" 
            />
            
            </a>

        <div class="hidden lg:flex items-center gap-10">
            <a href="/" class="nav-link eng text-xs font-bold uppercase tracking-widest text-white/60 hover:text-[#D4AF37] transition-colors">Home</a>

            <div class="relative group h-24 flex items-center">
                <a href="/shop" class="nav-link eng text-xs font-bold uppercase tracking-widest text-white/60 group-hover:text-[#D4AF37] transition-colors flex items-center gap-1">
                    Shop
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="group-hover:rotate-180 transition-transform duration-300"><path d="m6 9 6 6 6-6"/></svg>
                </a>

                <div class="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-4">
                    <div class="bg-[#0a0a0a] border border-[#D4AF37]/20 rounded-2xl p-2 min-w-[240px] shadow-[0_0_50px_rgba(0,0,0,0.9)] backdrop-blur-xl flex flex-col relative overflow-hidden">
                        
                        <div class="absolute -top-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-[#0a0a0a] border-t border-l border-[#D4AF37]/20 transform rotate-45"></div>
                        
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#D4AF37] to-transparent opacity-50"></div>

                        <a href="/shop" class="px-4 py-3 rounded-xl hover:bg-white/5 flex items-center justify-between group/item mb-1 transition-colors">
                            <span class="text-white text-xs font-black uppercase tracking-widest">All Products</span>
                            <svg class="w-4 h-4 text-[#D4AF37] -translate-x-2 opacity-0 group-hover/item:opacity-100 group-hover/item:translate-x-0 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                        </a>

                        <div class="h-[1px] bg-white/5 mx-2 mb-2"></div>

                        <a href="/shop#clock" class="px-4 py-3 rounded-xl hover:bg-white/5 text-white/60 hover:text-[#D4AF37] text-xs font-bold uppercase tracking-widest transition-colors flex items-center gap-3 group/item">
                            <svg class="w-4 h-4 text-white/30 group-hover/item:text-[#D4AF37] transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            CryptoClock
                        </a>
                        <a href="/shop#kiosk" class="px-4 py-3 rounded-xl hover:bg-white/5 text-white/60 hover:text-[#D4AF37] text-xs font-bold uppercase tracking-widest transition-colors flex items-center gap-3 group/item">
                            <svg class="w-4 h-4 text-white/30 group-hover/item:text-[#D4AF37] transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                            BiTTerm
                        </a>
                        <a href="/shop#pos" class="px-4 py-3 rounded-xl hover:bg-white/5 text-white/60 hover:text-[#D4AF37] text-xs font-bold uppercase tracking-widest transition-colors flex items-center gap-3 group/item">
                            <svg class="w-4 h-4 text-white/30 group-hover/item:text-[#D4AF37] transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                            BiTPos
                        </a>
                        <a href="/shop#node" class="px-4 py-3 rounded-xl hover:bg-white/5 text-white/60 hover:text-[#D4AF37] text-xs font-bold uppercase tracking-widest transition-colors flex items-center gap-3 group/item">
                            <svg class="w-4 h-4 text-white/30 group-hover/item:text-[#D4AF37] transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"/><line x1="8" y1="16" x2="8.01" y2="16"/><line x1="8" y1="20" x2="8.01" y2="20"/><line x1="12" y1="18" x2="12.01" y2="18"/><line x1="12" y1="22" x2="12.01" y2="22"/><line x1="16" y1="16" x2="16.01" y2="16"/><line x1="16" y1="20" x2="16.01" y2="20"/></svg>
                            BiTNode
                        </a>
                    </div>
                </div>
            </div>

            <a href="/course" class="nav-link eng text-xs font-bold uppercase tracking-widest text-white/60 hover:text-[#D4AF37] transition-colors">Courses</a>
            <a href="/blog" class="nav-link eng text-xs font-bold uppercase tracking-widest text-white/60 hover:text-[#D4AF37] transition-colors">Knowledge</a>
        </div>

        <div class="flex items-center gap-6">
            <a href="https://linktr.ee/CryptoClock" target="_blank" class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full border border-white/10 hover:border-[#D4AF37] transition-all group">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="eng text-[10px] font-bold uppercase tracking-widest text-white group-hover:text-[#D4AF37]">Support</span>
            </a>

            <button id="cart-trigger" class="relative group p-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white group-hover:text-[#D4AF37] transition-colors"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                <span class="cart-count absolute -top-1 -right-1 w-5 h-5 bg-[#D4AF37] text-black text-[10px] font-black flex items-center justify-center rounded-full transform scale-0 transition-transform duration-300">0</span>
            </button>

            <button class="lg:hidden text-white hover:text-[#D4AF37]">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
            </button>
        </div>
    </div>
</nav>

<style>
    .nav-link.active { color: #D4AF37; }
</style>

<script>
    import { cartStore } from '../lib/cartStore.js';

    document.addEventListener('astro:page-load', () => {
        // 1. ผูกปุ่มกดตะกร้าใหม่
        const cartBtn = document.getElementById('cart-trigger');
        if (cartBtn) {
            const newBtn = cartBtn.cloneNode(true);
            if(cartBtn.parentNode) cartBtn.parentNode.replaceChild(newBtn, cartBtn);
            newBtn.addEventListener('click', (e) => {
                e.preventDefault();
                cartStore.open();
            });
        }

        // 2. ฟังก์ชันอัปเดตตัวเลข
        const updateBadgeNavbar = () => {
            try {
                const { count } = cartStore.totals();
                const badges = document.querySelectorAll('.cart-count');
                badges.forEach(el => {
                    el.textContent = count.toString();
                    if (count > 0) {
                        el.classList.remove('scale-0');
                    } else {
                        el.classList.add('scale-0');
                    }
                });
            } catch (err) { }
        };

        // 3. เรียกใช้ทันที และรอฟังการเปลี่ยนแปลง
        updateBadgeNavbar();
        window.addEventListener('cart-updated', updateBadgeNavbar);

        // 4. Scroll Effect
        const nav = document.getElementById('main-nav');
        const navBg = document.getElementById('nav-bg');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                nav?.classList.add('py-0');
                navBg?.classList.remove('opacity-0'); 
            } else {
                nav?.classList.remove('py-0');
                navBg?.classList.add('opacity-0'); 

            }
        });
    });
</script>